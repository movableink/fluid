{{#let
  (if
    @hasError
    "border-error-main focus-within:border-error-main"
    (if
      @hasWarning
      "border-orange-400 focus-within:border-orange-200"
      "border-transparent focus-within:border-primary-dark bg-neutral-100 focus-within:bg-neutral-00"
    )
  )
  as |borderStyle|
}}
  <button
    type="button"
    class="flex items-center text-base leading-sm py-1 px-2 rounded-lg border focus:outline-none justify-between
      {{borderStyle}}
      {{if this.value "text-neutral-800" "text-neutral-600"}}
      {{@class}}"
    id={{@id}}
    ...attributes
    {{did-insert (set this "buttonElement")}}
    {{on "click" (set this "calendarIsVisible" true)}}
    {{on "keydown" this.dismissCalendarOnEscape}}
    {{click-outside this.dismissCalendarOnClickOutside}}
  >
    <span>
      {{if this.value (moment-format this.value "MMM D, YYYY") @placeholder}}
    </span>
    {{svg-jar "icon-calendar" class="h-4 w-4 ml-2"}}
  </button>
{{/let}}

{{#if this.calendarIsVisible}}
  <PowerCalendar
    class="body-base text-black bg-white shadow p-2 z-10"
    data-test-fluid-date-input-calendar=""
    @center={{this.calendarCenter}}
    @onCenterChange={{pick "date" (set this "calendarCenter")}}
    @selected={{this.value}}
    @daysComponent="fluid-date-input/power-calendar-days"
    @onSelect={{queue
      (set this "calendarIsVisible" false)
      (set this "calendarCenter" undefined)
      (pick "date" this.onSelect)
    }}
    {{did-insert (set this "calendarElement")}}
    {{on "keydown" this.dismissCalendarOnEscape}}
    {{click-outside this.dismissCalendarOnClickOutside}}
    {{popper-tooltip
      this.buttonElement
      (popper-modifier "offset" offset=(array 0 4))
      placement="bottom-start"
    }}
    as |calendar|
  >
    <nav class="flex justify-between items-center mb-2">
      <button
        type="button"
        data-test-calendar-nav-control="previous"
        class="fluid-button size:xs type:plain text-current"
        {{on "click" (fn calendar.actions.moveCenter -1 "month")}}
      >
        ◀
        <span class="sr-only">
          Previous Month
        </span>
      </button>

      <span class="body-sm font-bold">
        {{moment-format calendar.center "MMMM YYYY"}}
      </span>

      <button
        type="button"
        data-test-calendar-nav-control="next"
        class="fluid-button size:xs type:plain text-current"
        {{on "click" (fn calendar.actions.moveCenter 1 "month")}}
      >
        ▶
        <span class="sr-only">
          Next Month
        </span>
      </button>
    </nav>

    <calendar.Days @maxDate={{this.maxDate}} @minDate={{this.minDate}} />
  </PowerCalendar>
{{/if}}